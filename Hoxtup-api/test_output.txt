
> hoxtup-api@1.0.0 test
> vitest run src/modules/billing/billing.test.ts


[1m[46m RUN [49m[22m [36mv4.0.18 [39m[90m/home/barry/workspaces/Barry/Hoxtup-project/Hoxtup-api[39m

{"level":30,"time":1770594239107,"pid":77431,"hostname":"Barry","req":{"method":"POST","url":"/api/auth/sign-up/email","query":{},"params":{}},"res":{"statusCode":200},"responseTime":403,"msg":"request completed"}
{"level":50,"time":1770594239228,"pid":77431,"hostname":"Barry","err":{"type":"InternalServerError","message":"/response/id must match format \"uuid\"","stack":"Internal Server Error: /response/id must match format \"uuid\"\n    at ResponseValidator._validate (/home/barry/workspaces/Barry/Hoxtup-project/Hoxtup-api/node_modules/.pnpm/express-openapi-validator@5.6.2_@types+json-schema@7.0.15_express@5.2.1/node_modules/express-openapi-validator/dist/middlewares/openapi.response.validator.js:153:19)\n    at /home/barry/workspaces/Barry/Hoxtup-project/Hoxtup-api/node_modules/.pnpm/express-openapi-validator@5.6.2_@types+json-schema@7.0.15_express@5.2.1/node_modules/express-openapi-validator/dist/middlewares/openapi.response.validator.js:43:33\n    at ServerResponse.json_hook (/home/barry/workspaces/Barry/Hoxtup-project/Hoxtup-api/node_modules/.pnpm/express-openapi-validator@5.6.2_@types+json-schema@7.0.15_express@5.2.1/node_modules/express-openapi-validator/dist/framework/modded.express.mung.js:35:24)\n    at createOrganization (/home/barry/workspaces/Barry/Hoxtup-project/Hoxtup-api/src/modules/auth/auth.controller.ts:34:21)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","aggregateErrors":[{"type":"Object","message":"must match format \"uuid\"","stack":"","path":"/response/id","errorCode":"format.openapi.validation"}],"name":"Internal Server Error","status":500,"path":"/api/v1/organizations","errors":[{"path":"/response/id","message":"must match format \"uuid\"","errorCode":"format.openapi.validation"}]},"msg":"Unhandled error"}
{"level":30,"time":1770594239232,"pid":77431,"hostname":"Barry","req":{"method":"POST","url":"/api/v1/organizations","query":{},"params":{}},"res":{"statusCode":500},"err":{"type":"Error","message":"failed with status code 500","stack":"Error: failed with status code 500\n    at onResFinished (/home/barry/workspaces/Barry/Hoxtup-project/Hoxtup-api/node_modules/.pnpm/pino-http@11.0.0/node_modules/pino-http/logger.js:115:39)\n    at ServerResponse.onResponseComplete (/home/barry/workspaces/Barry/Hoxtup-project/Hoxtup-api/node_modules/.pnpm/pino-http@11.0.0/node_modules/pino-http/logger.js:178:14)\n    at ServerResponse.emit (node:events:531:35)\n    at onFinish (node:_http_outgoing:1082:10)\n    at callback (node:internal/streams/writable:766:21)\n    at afterWrite (node:internal/streams/writable:710:5)\n    at afterWriteTick (node:internal/streams/writable:696:10)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"},"responseTime":109,"msg":"request errored"}
 [31mâ¯[39m src/modules/billing/billing.test.ts [2m([22m[2m14 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m[33m 625[2mms[22m[39m
       [2m[90mâ†“[39m[22m should list all plans (AC-1)
       [2m[90mâ†“[39m[22m should return subscription with usage (AC-8)
       [2m[90mâ†“[39m[22m should handle webhook subscription.created (AC-3)
       [2m[90mâ†“[39m[22m should handle webhook subscription.canceled (AC-4)
       [2m[90mâ†“[39m[22m should enforce property limit (AC-5)
       [2m[90mâ†“[39m[22m should init trial subscription (AC-1)
       [2m[90mâ†“[39m[22m should not create duplicate trial (AC-1)
       [2m[90mâ†“[39m[22m should compute trial days remaining
       [2m[90mâ†“[39m[22m should detect read-only for PAST_DUE (AC-4)
       [2m[90mâ†“[39m[22m should detect active subscription
       [2m[90mâ†“[39m[22m should return billing overview with usage (AC-1)
       [2m[90mâ†“[39m[22m should cancel subscription (AC-6)
       [2m[90mâ†“[39m[22m should return 404 for missing subscription
       [2m[90mâ†“[39m[22m should detect 80% usage threshold (AC-5)

[31mâ¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Suites 1 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m src/modules/billing/billing.test.ts[2m > [22mEpic 8: Billing & Subscription
[31m[1mAssertionError[22m: expected 500 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 500[39m

[36m [2mâ¯[22m src/modules/billing/billing.test.ts:[2m35:27[22m[39m
    [90m 33| [39m      [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m sessionCookie)
    [90m 34| [39m      .send({ organizationName: `${TEST_PREFIX} Org`, firstName: 'Billâ€¦
    [90m 35| [39m    [34mexpect[39m(orgRes[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)
    [90m   | [39m                          [31m^[39m
    [90m 36| [39m    orgId [33m=[39m orgRes[33m.[39mbody[33m.[39mid
    [90m 37| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/1]â¯[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [33m14 skipped[39m[90m (14)[39m
[2m   Start at [22m 00:43:55
[2m   Duration [22m 3.34s[2m (transform 724ms, setup 0ms, import 2.25s, tests 625ms, environment 0ms)[22m

